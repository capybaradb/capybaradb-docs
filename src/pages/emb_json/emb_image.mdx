# EmbImage

**EmbImage** is one of the **EmbJSON** data types supported by OneNode DB, specifically designed for handling image embeddings. EmbImage allows you to store image data and generate text representations through image-to-text models, enabling semantic searches based on image content.

## Structure of EmbImage

The structure of EmbImage allows for embedding images, specifying models for image-to-text and text embedding, and optionally storing the image data itself:

```json
{
  "@embImage": {
    "data": "binary data of the image",
    "emb_model": "text-embedding-3-small",
    "vision_model": "gpt-4o-mini",
    "store_image": "true"
  }
}
```

### Key Components

- **data**: This field contains the binary data of the image, which will be processed and embedded.
- **emb_model** (optional): The model used for text embeddings. The default model is `text-embedding-3-small`, but you can specify other supported models if needed. This parameter is optional.
- **vision_model** (optional): The model used to convert the image to text. The default model is `gpt-4o-mini`, but you can specify other supported models. This parameter is also optional.
- **store_image** (optional): A boolean value (`true` or `false`). If `true`, the binary image data will be stored in a media database, and a URL will be generated to access the image later. The default value is `false`.

## How EmbImage Works

When an **EmbImage** field is inserted into OneNode DB, the following processes occur:

1. **Image-to-Text Conversion**: The image data is processed using the specified `vision_model`, which generates a textual description of the image. This text is then used for embedding and indexing.
   
2. **Text Embedding**: The generated text is processed using the specified `emb_model`, and the resulting embeddings are indexed for semantic search operations.

3. **Storing Image Data (Optional)**: If the `store_image` parameter is set to `true`, the binary image data will be stored in OneNode DB’s media storage, and a URL will be generated for future access. This is useful when users not only need the text descriptions of the image but also the original image itself as a reference. For example, if you're building a media library or a visual search engine, having access to both the semantic description and the original image can be highly valuable. If `store_image` is not set or is set to `false`, only the embeddings and chunks will be stored, without saving the image data itself.

4. **Asynchronous Processing**: As with other **EmbJSON** types, the embedding and indexing process happens asynchronously. It may take a few seconds for the document to be fully available for querying.

## Additional Fields Added After Storing

Once the **EmbImage** data is successfully processed and indexed, OneNode DB automatically adds the following fields to the document:

- **chunks**: A list of text chunks generated from the image-to-text process, which represent the semantic meaning of the image.
- **url**: A URL that provides access to the stored image. This field is only present if the `store_image` parameter is set to `true`.

## Example Usage of EmbImage

Here’s an example of how you would use **EmbImage** in a document:

```json
{
  "_id": { "$oid": "64d2f8f01234abcd5678ef90" },
  "name": "Alice",
  "profile_image": {
    "@embImage": {
      "data": "<binary image data>",
      "emb_model": "text-embedding-3-small",
      "vision_model": "gpt-4o-mini",
      "store_image": true
    }
  }
}
```

In this example:
- The **profile_image** field uses the **EmbImage** data type to embed and index the image data.
- The text embedding model is set to `text-embedding-3-small`, and the image-to-text model is set to `gpt-4o-mini`.
- The `store_image` parameter is set to `true`, meaning the image binary data will be stored, and a URL will be generated for later access.

## Example of EmbImage with Additional Fields After Storing

Once the image is processed and stored, the **EmbImage** field in the document will automatically have additional fields added:

```json
{
  "_id": { "$oid": "64d2f8f01234abcd5678ef90" },
  "name": "Alice",
  "profile_image": {
    "@embImage": {
      "data": "<binary image data>",
      "emb_model": "text-embedding-3-small",
      "vision_model": "gpt-4o-mini",
      "store_image": true,
      "chunks": [
        "A woman standing in front of a tree.",
        "The image shows a person smiling outdoors."
      ],
      "url": "https://media.onenode.ai/123abc/profile_image.png"
    }
  }
}
```

In this case:
- The **chunks** field contains a list of text representations generated by the image-to-text model.
- The **url** field provides a link to the saved image, as the `store_image` parameter was set to `true`.

## Important Considerations

- **Optional Parameters**: Both `emb_model` and `vision_model` are optional. If not provided, the default models (`text-embedding-3-small` and `gpt-4o-mini`) will be used.
  
- **store_image Parameter**: If you want the binary image data to be stored and accessible via a URL, set the `store_image` parameter to `true`. Otherwise, only the text embeddings and chunks will be stored.

- **Asynchronous Processing**: As with other **EmbJSON** types, the embedding and indexing process happens asynchronously. It may take a few seconds for the document to be fully indexed and available for querying.

- **Nested Fields**: Similar to **EmbText**, **EmbImage** fields can be used within nested structures in documents. The embedding and indexing process will work the same way, regardless of where the field is located.

### Example of EmbImage in Nested Fields

```json
{
  "_id": { "$oid": "64d2f8f01234abcd5678ef91" },
  "profile": {
    "name": "Bob",
    "profile_picture": {
      "@embImage": {
        "data": "<binary image data>",
        "vision_model": "gpt-4o-mini",
        "store_image": false
      }
    }
  }
}
```

In this example:
- The **profile_picture** field contains the **EmbImage** data type, embedded and indexed based on the image content.
- The image is not stored, as the `store_image` parameter is set to `false`, meaning no URL is generated.

## Use Cases for EmbImage

- **Image-Based Semantic Search**: EmbImage is ideal for applications where images need to be searched based on their semantic meaning, such as retrieving images based on their content description.
  
- **Image Classification**: EmbImage can be used in projects that require extracting meaningful information from images, like object recognition or classification tasks.
